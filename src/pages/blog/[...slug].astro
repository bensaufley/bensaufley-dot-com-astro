---
import type { GetStaticPaths } from 'astro';
import { getCollection, getEntry } from 'astro:content';
import dayjs from 'dayjs';
import utc from 'dayjs/plugin/utc';

import Post from '../../components/blog/Post';
import BaseLayout from '../../layouts/BaseLayout.astro';

dayjs.extend(utc);

export const getStaticPaths: GetStaticPaths = async () => {
  const posts = await getCollection('posts');
  return posts.map((post) => ({ data: post.data, params: { slug: post.slug } }));
};

const { slug } = Astro.params;
const post = (await getEntry('posts', slug as string))!;
const {
  data: { title, date, headerImage, headerImageAlt },
} = post;
const img = headerImage ? { url: headerImage.src, alt: headerImageAlt! } : undefined;
const published = dayjs.utc(date).startOf('day');

const { Content } = await post.render();
---

<BaseLayout title={title}>
  <Post title={title} posted={published} headerImage={img}>
    <Content />
  </Post>
</BaseLayout>
