---
import dayjs from 'dayjs';
import utc from 'dayjs/plugin/utc';
import { Fragment } from 'preact';

import Pagination from '~components/Pagination';
import BaseLayout from '~layouts/BaseLayout.astro';
import { getFeed } from '~lib/feed';

import EntryBook from './EntryBook.astro';
import EntryPost from './EntryPost.astro';

dayjs.extend(utc);
export interface Props {
  class?: string | undefined;
  page: number;
}

const { class: className, page } = Astro.props as Props;

export const PER_PAGE = 5;

const [renderedEntries, entries] = await getFeed(page, PER_PAGE);

const pages = Math.ceil(entries / PER_PAGE);
---

<BaseLayout
  class={className}
  frontmatter={{ title: page === 1 ? 'Home' : 'Blog', icon: 'house' }}
  url={page === 1 ? '/' : `/blog/${page}`}
>
  {
    renderedEntries.map((entry, i) => (
      <Fragment key={entry.slug}>
        {i !== 0 && <hr />}
        {entry.collection === 'posts' ? (
          <EntryPost entry={entry} />
        ) : (
          <EntryBook entry={entry} />
        )}
      </Fragment>
    ))
  }
  <Pagination page={page} pages={pages} path="/blog/" />
</BaseLayout>
